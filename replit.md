# Babu Shobhnath Singh Memorial Trust - Cultural Platform

## Project Overview
A bilingual (Hindi/English) Progressive Web Application for the Babu Shobhnath Singh Memorial Trust, dedicated to Literature, Education, and Cultural initiatives across India.

### Target Audience
- Primary: Age 50+ audience (less tech-savvy individuals)
- Secondary: Multi-generational families, community members
- Geographic: India-based with global reach

### Core Features
- **Bilingual Support**: Hindi and English with infrastructure for future languages
- **Guest Browsing**: Full access without registration
- **User Authentication**: Replit Auth with multiple login options (Google, Email/Password, etc.) - Email/password recommended for target audience
- **Content Management**: Events, Blogs, Poetry with rich text support
- **Admin Portal**: Role-based access control for content management
- **Media Management**: Image uploads for events and content
- **PWA**: Installable on mobile, tablet, and desktop devices

## Technical Stack

### Frontend
- React 18 with TypeScript
- Wouter for routing
- TanStack Query for data fetching
- Tailwind CSS + Shadcn UI components
- i18n with custom language context
- Dark mode support

### Backend
- Express.js
- PostgreSQL (Neon) with Drizzle ORM
- Replit Auth (OIDC) with multiple providers - Email/password primary method for target audience
- Session management with connect-pg-simple
- File uploads with Multer

### Database Schema
- **users**: User profiles with roles (user, admin, content_manager)
- **events**: Multilingual event information
- **blogs**: Articles and blog posts
- **poetry**: Poetry and kavita collection
- **sessions**: Auth session storage

## Project Structure

```
/
â”œâ”€â”€ client/              # React frontend
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/  # Reusable UI components
â”‚   â”‚   â”œâ”€â”€ contexts/    # Language & Theme providers
â”‚   â”‚   â”œâ”€â”€ hooks/       # useAuth hook
â”‚   â”‚   â”œâ”€â”€ lib/         # i18n translations, utilities
â”‚   â”‚   â”œâ”€â”€ pages/       # Page components
â”‚   â”‚   â””â”€â”€ App.tsx      # Main app component
â”‚   â””â”€â”€ index.html
â”‚
â”œâ”€â”€ server/              # Express backend
â”‚   â”œâ”€â”€ db.ts           # Database connection
â”‚   â”œâ”€â”€ storage.ts      # Data access layer
â”‚   â”œâ”€â”€ routes.ts       # API endpoints
â”‚   â”œâ”€â”€ replitAuth.ts   # Authentication setup
â”‚   â”œâ”€â”€ upload.ts       # File upload config
â”‚   â”œâ”€â”€ seed.ts         # Database seeding
â”‚   â””â”€â”€ index.ts        # Server entry
â”‚
â”œâ”€â”€ shared/             # Shared types
â”‚   â””â”€â”€ schema.ts      # Database schema & types
â”‚
â””â”€â”€ attached_assets/
    â”œâ”€â”€ generated_images/  # AI-generated images
    â””â”€â”€ uploads/           # User-uploaded media
```

## API Endpoints

### Public Routes
- `GET /api/events` - List all published events
- `GET /api/events/:id` - Get event details
- `GET /api/events/category/:category` - Filter by category
- `GET /api/events/search/:query` - Search events
- `GET /api/blogs` - List all published blogs  
- `GET /api/blogs/:id` - Get blog details
- `GET /api/poetry` - List all published poetry
- `GET /api/poetry/:id` - Get poetry details

### Auth Routes
- `GET /api/login` - Start login flow
- `GET /api/logout` - Logout
- `GET /api/auth/user` - Get current user (protected)
- `PATCH /api/user/whatsapp-opt-in` - Update preferences (protected)

### Admin Routes (Role-based)
- `POST /api/admin/events` - Create event
- `PATCH /api/admin/events/:id` - Update event
- `DELETE /api/admin/events/:id` - Delete event
- `GET /api/admin/events` - List all events (published & drafts)
- Similar routes for `/api/admin/blogs` and `/api/admin/poetry`
- `POST /api/admin/upload` - Upload media files
- `PATCH /api/admin/users/:id/role` - Update user roles

## Development

### Environment Variables
```
DATABASE_URL=<postgres-connection-string>
SESSION_SECRET=<auto-generated>
SEED_DATABASE=true  # Set to seed on startup
```

### Database Management
```bash
# Push schema changes to database
npm run db:push

# Open Drizzle Studio for database inspection
npm run db:studio
```

### Starting Development Server
```bash
npm run dev
# Server runs on http://localhost:5000
```

## User Roles

### Guest Users
- Browse all public content
- View events, blogs, and poetry
- Switch languages
- No authentication required

### Registered Users  
- All guest capabilities
- Create profile
- Opt-in to WhatsApp notifications (future feature)

### Content Managers
- Create, edit, and publish content
- Upload media files
- Manage events, blogs, and poetry

### Admins
- All content manager capabilities
- Manage user roles
- Access full admin panel

## Future Roadmap

### Phase 2 Features
1. **WhatsApp Notifications** via Twilio
   - Event announcements
   - New content alerts
   - User opt-in/out already implemented

2. **Facebook OAuth**
   - Additional login method

3. **Additional Languages**
   - Marathi, Sanskrit, regional languages
   - Admin-controlled language management

4. **Advanced PWA**
   - Offline content caching
   - Web push notifications

5. **Analytics Dashboard**
   - User engagement metrics
   - Popular content tracking

6. **Donation Module**
   - Support trust initiatives online

## Design Principles

### Age-Friendly UI
- Large typography (18px+ base)
- High contrast color scheme
- Simple, clear navigation
- Minimal cognitive load
- Touch-friendly (48px minimum targets)

### Accessibility
- WCAG 2.1 AA compliance
- Keyboard navigation
- Screen reader support
- Clear focus indicators

### Responsive Design
- Mobile-first approach
- Works on all device sizes
- Touch-optimized interactions

## Branding

**Trust Name**: Babu Shobhnath Singh Memorial Trust  
**Facebook**: https://www.facebook.com/share/17gwKTpcyH/  
**Logo**: Located at `/attached_assets/Logo_Babu Shobhnath Singh Memorial Trust_1762000641843.jpeg`

**Color Scheme**: Warm oranges for primary actions, neutral grays for backgrounds

## Notes

- The application uses Replit's built-in database (PostgreSQL via Neon)
- Authentication is handled by Replit Auth (supports Google, GitHub, X, Apple, email/password)
- Object storage is configured for media files
- All timestamps are stored in UTC
- Content supports both English and Hindi with fallbacks

## Database Seeding

On first run with `SEED_DATABASE=true`, the application seeds:
- 3 sample events (Kavi Sammelan, Education Drive, Reading Session)
- 1 sample blog post
- 3 sample poetry pieces

This provides immediate content for testing and demonstration.

## Testing Approach

- Use Playwright for end-to-end testing
- Test user journeys: guest browsing, auth flow, content creation
- Verify bilingual content display
- Check responsive design across devices
- Validate admin permissions

## Implementation Status

### âœ… Completed (MVP - Ready for User Testing)
1. **Database Schema** - PostgreSQL with Drizzle ORM
   - Users table with role-based access
   - Events, blogs, poetry tables with bilingual fields
   - Session management for auth
2. **Backend API** - Express.js with full validation
   - All CRUD routes for events, blogs, poetry
   - Zod validation on all mutating endpoints
   - Role-based auth middleware (user, admin, content_manager)
3. **Authentication** - Replit Auth (OIDC)
   - Google OAuth + email/password support
   - Session-based authentication
   - Protected admin routes
4. **Media Upload** - Multer integration
   - Image upload for events and content
   - 5MB file size limit
   - Static file serving configured
5. **Frontend Infrastructure**
   - Bilingual support (Hindi/English) with i18n
   - Theme support (light/dark mode)
   - Responsive header with navigation
   - Footer with quick links and social media
   - Mobile-friendly hamburger menu
6. **Public Pages (Guest Access)**
   - Homepage with featured content from all categories
   - Events listing page with search and category filtering
   - Blogs listing page with search
   - Poetry listing page with search
   - Event detail pages with full bilingual content
   - Blog detail pages with full bilingual content
   - Poetry detail pages with full bilingual content
   - About page with trust information and mission
7. **Accessibility**
   - Keyboard navigation on all interactive elements
   - Screen reader support with ARIA labels
   - Large text sizes for 50+ audience
   - High contrast color schemes
   - Touch-friendly tap targets (48px minimum)
8. **Database Seeding** - Idempotent demo content
   - 3 sample events
   - 1 sample blog
   - 3 sample poems
9. **Testing Documentation**
   - Comprehensive TEST_PLAN.md with 18 test categories
   - Step-by-step test specifications for all features
   - Cross-browser testing guidelines
   - Accessibility testing protocols

### âœ… Recently Completed (Admin Portal MVP)
1. **Admin Portal - Complete**
   - Admin dashboard with stats (total/published/draft counts)
   - Events management (CRUD with bilingual forms, image upload, date picker)
   - Blogs management (CRUD with bilingual forms, image upload)
   - Poetry management (CRUD with bilingual forms, image upload)
   - User management (view all users, inline role editing - admin only)
   - Role-based access control (admin, content_manager, user)
   - Sidebar navigation with protected routes
   - Full bilingual support (English/Hindi) for all admin UI
   - Large fonts (text-base+) for 50+ accessibility
   - All interactive elements have data-testids for testing

### ðŸš§ Pending (Future Roadmap)
1. **User Profile**
   - Profile view/edit
   - WhatsApp opt-in/out UI
2. **WhatsApp Notifications** via Twilio
   - Event announcements
   - New content alerts
3. **Progressive Web App Features**
   - Service worker for offline access
   - Add to home screen prompt
   - Push notifications

## Recent Changes
- 2024-11-28 (Updated):
  - **Application Resilience, Security & Logging Improvements:**
    - Added ErrorState component with bilingual support (English/Hindi) for user-friendly error handling
    - Implemented React ErrorBoundary wrapping main router to prevent full app crashes
    - Applied error handling to all listing and detail pages (Events, Blogs, Poetry, Home)
    - API error responses now sanitized in production - no stack traces or internal details exposed
    - Implemented rate limiting with express-rate-limit:
      - General API: 100 requests/15 min
      - Auth endpoints: 20 requests/15 min (stricter)
      - Admin endpoints: 50 requests/15 min
      - Upload endpoint: 20 requests/hour
    - **Structured Logging with Winston:**
      - Production-ready logging configuration (server/logger.ts)
      - Structured JSON format for parsed logs in production
      - Console logging in development with readable format
      - File logging in production: error.log and combined.log (5MB max, 5 files rotation)
      - All API routes now use logger.error for error logging
      - API request middleware logs structured data: method, path, status, duration, IP, user-agent
      - Automatic log level adjustment: warn for 4xx/5xx responses, info for 2xx/3xx
    - All error translations added to i18n system for bilingual consistency
    - End-to-end tested - all 18 test steps passed
- 2024-11-02:
  - **Admin Portal Complete:**
    - Created BlogForm and PoetryForm with bilingual fields, image upload, validation
    - Built User Management page with role editing (admin-only feature)
    - Added comprehensive bilingual translations for all admin UI elements
    - All forms support create/edit modes with proper error handling
    - Backend routes: GET /api/admin/users, storage.getAllUsers() implemented
    - Simple textarea chosen over rich text editor for 50+ accessibility
    - Admin portal ready for end-to-end testing
- 2024-11-01: 
  - Implemented all public-facing pages (Events, Blogs, Poetry listing and detail pages)
  - Built About page with trust information
  - Added search functionality across all content types
  - Implemented keyboard accessibility for all card components
  - Fixed nested anchor tag warnings in Footer
  - Created comprehensive TEST_PLAN.md with 18 test categories
  - Validated all features with architect reviews
  - **Authentication Enhancement:**
    - Implemented functional user menu (desktop dropdown + mobile button)
    - Configured Replit Auth with email/password as primary authentication method
    - **Auth Configuration Note:** Multiple OAuth providers (Google, Apple, X, GitHub, Email) appear on login page due to Replit Auth platform architecture. Email/password option is available and fully functional for target audience (50+ users). This is an accepted architectural constraint - users can choose email option which provides familiar authentication experience.
    - User authentication working correctly: login, logout, session management all functional
    - Optimized for 50+ age group target audience (email/password is familiar and accessible)
  - Application ready for user acceptance testing and publishing
